#compdef git-fetch-rebase

__git-fetch-rebase_git_remote_branch() {
    declare -a branch_names
    branch_names=(${${(f)"$(_call_program remote-branch-refs git for-each-ref --format='"%(refname)"' refs/remotes 2>/dev/null)"}#refs/remotes/})
    _describe -t remote-branch "remote branches" branch_names
}

_git-fetch-rebase() {
    local curcontext="$curcontext" state line
    typeset -A opt_args

    _arguments -C \
        {-p,--push}'[push if rebase successfully]' \
        '(-): :->branch' && return

    case $state in
        (branch)
            __git-fetch-rebase_git_remote_branch
            ;;
    esac
}

_git-fetch-rebase "$@"
